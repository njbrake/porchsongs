# Definition of Done

## Test Requirements

**Bug fixes must include a test** that reproduces the bug and verifies the fix. Feature changes should include tests for new behavior. If an existing test file covers the component/module, add tests there; otherwise create a new `*.test.ts(x)` file following existing patterns.

## Checks

Every change must pass all checks before it's considered complete:

```bash
uv run ruff check backend/                    # backend lint
uv run ruff format --check backend/           # backend formatting
cd frontend && npx eslint src/                # frontend lint
cd frontend && npm run typecheck              # TypeScript type check
DATABASE_URL="sqlite:///:memory:" uv run pytest  # backend tests
cd frontend && npx vitest run                 # frontend tests
```

## PR Submissions with UI Changes

PRs that include frontend/UI changes must attach a **Playwright-recorded video** (`.webm`) in the PR description demonstrating the change. This ensures reviewers can visually verify layout, styling, and interactions without pulling the branch locally.

### How to record

Use a short Playwright script to record a `.webm` video of the relevant workflow. This uses `playwright-core` which is already installed as a dependency of the e2e tests.

```bash
# Start the dev server first
cd frontend && npm run dev &
```

```js
node -e "
const { chromium } = require('playwright-core');
(async () => {
  const browser = await chromium.launch({
    headless: true,
    chromiumSandbox: false,
    executablePath: '/root/.cache/ms-playwright/chromium-1208/chrome-linux/chrome'
  });
  const context = await browser.newContext({
    viewport: { width: 1280, height: 900 },
    recordVideo: { dir: 'test-results/', size: { width: 1280, height: 900 } }
  });
  const page = await context.newPage();

  // Navigate and interact with the UI change you're demonstrating
  await page.goto('http://localhost:5173/app');
  await page.waitForTimeout(2000);

  // ... add interactions that demonstrate the change ...

  await context.close();  // video is saved on context close
  await browser.close();
  console.log('Video saved to test-results/');
})();
"
```

### Where videos land

Videos are saved to `test-results/` as `.webm` files. The filename is auto-generated by Playwright.

### Attaching to the PR

Upload the `.webm` file to the GitHub PR description by dragging it into the description editor, or use the `gh` CLI:

```bash
# Reference the video in the PR body (GitHub renders .webm inline)
gh pr create --title "feat: update song card layout" --body "$(cat <<'EOF'
## Summary
- Redesigned song card with new chord coloring

## Demo video
<!-- Drag the .webm file here, or paste after creating the PR -->

## Test plan
- [x] Visual verification via Playwright recording
- [x] Frontend tests pass
EOF
)"
```
